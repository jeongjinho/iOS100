# Lean To FileManager and  iPhone Store  ArchitectureLean To FileManager and  iPhone Store  Architecture





### Apple's app is Sandbox architecture!

Sandbox구조라는 것은 무엇 일까요? 

미국인의 문화에서 비롯되었는데요.   아이들이 놀 때 모래상자를 가지고 놀게하여 밖으로 모래가 빠져나가거나 다른 것이 들어오지 않게하는 것입니다. 이렇게 되면 아이들이 그 모래상자에 들어있던 장난감을 잃어버릴 일도 없고 누가 거기에 원래있던것과 다른 것을 놓을 일도 없게되겠죠. 왜냐면 우리는 그샌드박스안에서 놀거기 때문입니다.



애플의 앱도 마찬가로 이런 샌드박스의 구조를 가지고 있습니다. 앱을 하나의 샌드박스라고 치면 두개의 앱은 두개의 샌드박스가 되는 것이죠

두개의 샌드박스는 서로에 접근하지 못합니다. 그것 각각으로서만 사용하는 샌드박스이기 때문입니다.





# ![스크린샷 2018-10-29 오후 8.05.22](/Users/afreecatv/Desktop/스크린샷 2018-10-29 오후 8.05.22.png)



위에 그림은 iOS구조를 나타내는 대표적인 그림 입니다. 

샌드박스에서 번들 컨테이너, 데이터 컨테이너, iCloud Container  이 세가지의 영역으로 나누어져있습니다.



### Bundle Container 

앱을 실행시키려면 코드가 필요합니다. 또한 이미지를 사용한 앱이라면 이미지와 음악앱이라면 기본내장 음악소스파일 같은 앱이 돌아갈 수 있는 자원들을 여기에 저장 시킵니다. 

개발할 때  넣는 이미지에셋이 여기에 저장된다고 보면됩니다.



### Data Container

데이터 컨테이너에는 또 크게 3가지로 나누어 집니다. 앱에 실행시키기위한 것이 번들컨테이너에 있다면 데이터 컨테이너는 유저가 실제로 사용할 수 있는 내용의 파일들을 저장하는 곳입니다. 



- #### Documents 

  일반적으로 사용자가 사용하면서 생성한  문서나 파일들을 저장하는 디렉토리입니다. 유저가 접근하길 원한다면 접근 할 수 있는 곳이죠! 또한 디렉토리 내용물은 아이클라우드 아이튠즈에 의해서 백업되어 관리됩니다.

- #### Document/Inbox

    이 디렉토리는 위에 것과는 좀 다르게 외부에 들어오는 파일이나 문서를 저장하는 곳입니다. 

  대표적으로 이 장소를 사용하는 곳이 메일앱입니다.  메일이 오고 그 안에 첨부파일이 있다면 이곳에 저장하는 것이죠.

  하지만 유저 스스로 이곳에 파일을 생성할 수는 없습니다.  읽고, 삭제는 가능하구요 만약 유저가 이 파일을 수정하려한다면 앱은 슬그머니 바뀌기전으로 옮겨놓아서 변경을 막습니다!

- #### Library

  이 디렉토리는 가장 상위의 디렉토리입니다. 그래서 유저의 관련된 파일이 있는건 아닙니다.  아이폰앱은 보통 어플리케이션서포터, 캐쉬 하위 디렉토리를 사용하는데요. 저희도 마찬가로 커스텀으로 하위디렉토리를 만들 수 있습니다. 

  유저들에게 노출되기 싫은 파일들이 있는 경우 우리는 Library 밑에 하위디렉토리를 만들어서 숨겨 놓을 수 있죠!  

  사용자들은 이 숨겨놓은 유저데이터 파일을 사용할 수 없을 겁니다. 

  또한 라이브러리 디렉토리안에 내용물은  아이튠즈나 아이클라우드에 의해서 백업되어 집니다.


- #### tmp

  이 디렉토리는 앱의 영구적으로는 필요없는 파일들을 임시적으로 저장하는 공간입니다.  앱은 사용자가 더이상 해당 파일이 필요없다고 생각돠면 삭제 할 수 있습니다.  또한 앱이 실행되징않는동안 이 디렉토리를 삭제해버리죠  이 디렉토리안에 있는 내용물은 위에 디렉토리와 다르게 백업되지 않습니다. 말그대로 백업이에요!



그 외외에 맥OS에 관한 특징도 있지만 일단 여기까지 !

### Files, Concurrency, and Thread Safety

iOS와 맥OS에서 파일에 연관된 일들은  하드디스크에 접근해서 이뤄지므로 그다지 빠르지 않습니다.  그래서 대부분의 파일과 과련된 것들은 동시 접속을 허용하는데  다수의 파일관련 기술들은  비동기적인 실행을 포함하는 경우가 많습니다.  물론 안전하게 디스패츠 큐 또는 예비스레드를 통해서 말이죠



- #### NSFileManager 

  대부분의 작업들은  이 NSFileManager에서 이루어지게 되는데요  이 기본적인 객체는 다수의 백그라운드 스레드를 사용하여  안전하게 일을 수행합니다. 하지만 파일매니저의 델리게이트을 제외를 하고 말이죠  우리가 파일매니저의 델리게이트를 사용할 때  NSFileManager클래스를 하나의 객체만 생성하도록 권고합니다. 그리고 그 인스턴스와 함께 델리게이트를 사용하죠 . 그래서 우리는  매순간 한 스레드에서만 유일하게 인스턴스를 사용할 수 있도록 해야합니다. 그래서  싱글턴패턴의 형태로 되어 있기도하죠.

- #### Grand Central Dispatch

  GCD은  어떤한 스레드도 사용할 수 있습니다. 하지만 우리는 GCD를 사용할 때 안전한 스레드를 사용하도록 블록을 써야합니다. 












